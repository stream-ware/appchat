<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamware MVP - Voice Dashboard</title>
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --secondary: #1e293b;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-input: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --border: #334155;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }
        
        /* ===== MAIN LAYOUT ===== */
        .container {
            display: flex;
            height: 100vh;
        }
        
        /* ===== APP VIEW (80%) ===== */
        .app-view {
            flex: 0 0 80%;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border);
            overflow: hidden;
        }
        
        .app-header {
            padding: 16px 24px;
            background: var(--secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .app-header h1 {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .app-header .subtitle {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-top: 4px;
        }
        
        .app-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            max-width: 70%;
        }
        
        .app-actions button {
            padding: 6px 12px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .app-actions button:hover {
            background: var(--primary);
            border-color: var(--primary);
        }
        
        .app-actions .skill-chip {
            padding: 4px 10px;
            background: var(--primary);
            border: none;
            border-radius: 16px;
            color: white;
            font-size: 0.75rem;
        }
        
        .app-actions .skill-chip:hover {
            opacity: 0.9;
            transform: scale(1.02);
        }
        
        .app-content {
            flex: 1;
            overflow: auto;
            padding: 24px;
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .stat-icon {
            font-size: 2rem;
        }
        
        .stat-content .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .stat-content .stat-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }
        
        /* Data Table */
        .data-table-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            background: var(--secondary);
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .data-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
        }
        
        .data-table tr:hover {
            background: rgba(59, 130, 246, 0.1);
        }
        
        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-success { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .badge-warning { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .badge-danger { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        .badge-info { background: rgba(59, 130, 246, 0.2); color: var(--primary); }
        
        /* Camera Grid */
        .camera-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        .camera-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .camera-feed {
            aspect-ratio: 16/9;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .camera-feed.offline {
            background: linear-gradient(135deg, #2d1f1f 0%, #1f1a1a 100%);
        }
        
        .camera-feed .camera-icon {
            font-size: 3rem;
            opacity: 0.5;
        }
        
        .camera-feed .status-indicator {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success);
        }
        
        .camera-feed .status-indicator.offline {
            background: var(--danger);
        }
        
        .camera-feed .detection-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: rgba(239, 68, 68, 0.9);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .camera-info {
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .camera-name {
            font-weight: 600;
        }
        
        .camera-meta {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }
        
        /* Chart Container */
        .chart-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }
        
        .chart-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .bar-chart {
            display: flex;
            align-items: flex-end;
            gap: 16px;
            height: 200px;
            padding: 20px 0;
        }
        
        .bar-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .bar {
            width: 100%;
            max-width: 60px;
            border-radius: 4px 4px 0 0;
            transition: height 0.5s ease;
        }
        
        .bar-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: center;
        }
        
        .bar-value {
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        /* Welcome/Empty State */
        .welcome-view {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 40px;
        }
        
        .welcome-icon {
            font-size: 4rem;
            margin-bottom: 24px;
        }
        
        .welcome-title {
            font-size: 1.75rem;
            margin-bottom: 12px;
        }
        
        .welcome-message {
            color: var(--text-secondary);
            white-space: pre-line;
            line-height: 1.8;
        }
        
        .command-suggestions {
            display: flex;
            gap: 12px;
            margin-top: 32px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .suggestion-chip {
            padding: 10px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .suggestion-chip:hover {
            border-color: var(--primary);
            background: rgba(59, 130, 246, 0.1);
        }
        
        /* Help View */
        .help-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
        }
        
        .help-category {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }
        
        .help-category h3 {
            font-size: 1rem;
            margin-bottom: 12px;
            color: var(--primary);
        }
        
        .help-commands {
            list-style: none;
        }
        
        .help-commands li {
            padding: 8px 0;
            color: var(--text-secondary);
            cursor: pointer;
        }
        
        .help-commands li:hover {
            color: var(--text-primary);
        }
        
        .help-commands li::before {
            content: "‚Üí ";
            color: var(--primary);
        }
        
        /* ===== APPS DASHBOARD ===== */
        .apps-dashboard {
            padding: 20px;
        }
        
        .user-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: var(--bg-card);
            border: 1px solid var(--success);
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .user-bar.guest {
            border-color: var(--warning);
        }
        
        .user-bar button {
            padding: 6px 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
        }
        
        .logout-btn { background: var(--danger); color: white; }
        .login-btn { background: var(--primary); color: white; }
        
        .quick-commands {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .quick-cmd {
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 0.85rem;
        }
        
        .quick-cmd:hover {
            border-color: var(--primary);
            background: rgba(59, 130, 246, 0.1);
        }
        
        .apps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }
        
        .app-card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .app-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }
        
        .app-card-header {
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .app-icon {
            font-size: 2rem;
        }
        
        .app-info h3 {
            font-size: 1rem;
            margin-bottom: 4px;
        }
        
        .app-info p {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .app-skills {
            padding: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .skill-btn {
            padding: 6px 12px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 16px;
            color: var(--text-primary);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .skill-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
        }
        
        .dashboard-footer {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }
        
        /* ===== LOGIN VIEW ===== */
        .login-view {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            padding: 40px;
        }
        
        .login-box {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 32px;
            max-width: 500px;
            width: 100%;
        }
        
        .login-box h2 {
            margin-bottom: 16px;
        }
        
        .login-box code {
            background: var(--bg-input);
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .demo-users {
            margin-top: 24px;
        }
        
        .demo-users h4 {
            margin-bottom: 12px;
            color: var(--text-secondary);
        }
        
        .user-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .user-item {
            padding: 12px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .user-item:hover {
            border-color: var(--primary);
            background: rgba(59, 130, 246, 0.1);
        }
        
        .user-item small {
            color: var(--text-secondary);
        }
        
        /* ===== ROOM/HOME VIEW ===== */
        .rooms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }
        
        .room-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
        }
        
        .room-card h4 {
            margin-bottom: 12px;
        }
        
        .room-stats {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        /* ===== SERVICES/INTERNET VIEW ===== */
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }
        
        .service-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
        }
        
        .service-icon {
            font-size: 1.5rem;
        }
        
        .service-name {
            flex: 1;
        }
        
        .service-status {
            font-size: 0.8rem;
            padding: 4px 8px;
            background: var(--bg-input);
            border-radius: 4px;
        }
        
        .service-status.active {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }
        
        /* ===== METRICS VIEW ===== */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 20px;
        }
        
        .metric-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .metric-name {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-bottom: 8px;
        }
        
        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .metric-change {
            color: var(--success);
            font-size: 0.85rem;
        }
        
        .info-message {
            padding: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            color: var(--text-secondary);
        }
        
        .system-view {
            padding: 40px;
            text-align: center;
        }
        
        .system-view h2 {
            margin-bottom: 16px;
        }
        
        /* ===== TTS INDICATOR ===== */
        .tts-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 8px 16px;
            background: var(--primary);
            border-radius: 20px;
            font-size: 0.85rem;
            display: none;
            z-index: 1000;
        }
        
        .tts-indicator.active {
            display: block;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        /* ===== COMMAND HISTORY PANEL ===== */
        .history-panel {
            border-top: 1px solid var(--border);
            padding: 8px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 8px;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .history-header button {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.7rem;
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 8px;
            margin: 2px 0;
            background: var(--bg-input);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }
        
        .history-item:hover {
            background: var(--primary);
        }
        
        .history-cmd {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .history-app {
            font-size: 0.65rem;
            padding: 2px 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            margin-left: 8px;
        }
        
        /* ===== BREADCRUMB / LOCATION ===== */
        .location-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--bg-input);
            border-bottom: 1px solid var(--border);
            font-size: 0.85rem;
        }
        
        .location-bar .home-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 1rem;
        }
        
        .location-bar .separator {
            color: var(--text-secondary);
        }
        
        .location-bar .current-location {
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .location-bar .back-btn {
            margin-left: auto;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 4px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .location-bar .back-btn:hover {
            border-color: var(--primary);
        }
        
        /* ===== QUICK ACTIONS PANEL ===== */
        .quick-actions {
            padding: 8px;
            border-bottom: 1px solid var(--border);
            background: rgba(0,0,0,0.2);
        }
        
        .quick-actions-header {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-bottom: 6px;
            text-transform: uppercase;
        }
        
        .quick-actions-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
        }
        
        .quick-action-btn {
            padding: 8px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.75rem;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .quick-action-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
        }
        
        /* ===== CONFIG BAR ===== */
        .config-bar {
            display: flex;
            justify-content: space-around;
            padding: 8px;
            background: var(--bg-input);
            border-top: 1px solid var(--border);
        }
        
        .config-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .config-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }
        
        /* Language Menu */
        .language-menu {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 8px;
            z-index: 1000;
            min-width: 200px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .language-menu-header {
            font-size: 0.85rem;
            color: var(--text-secondary);
            padding: 4px 8px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 8px;
        }
        
        .language-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
        }
        
        .lang-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 4px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: transparent;
            border: 1px solid transparent;
        }
        
        .lang-option:hover {
            background: var(--bg-input);
            border-color: var(--border);
        }
        
        .lang-option.active {
            background: var(--primary);
            border-color: var(--primary);
        }
        
        .lang-option .flag {
            font-size: 1.5rem;
        }
        
        .lang-option .name {
            font-size: 0.65rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }
        
        .lang-option.active .name {
            color: white;
        }
        
        .config-btn.active {
            background: var(--primary);
            color: white;
        }
        
        /* ===== CONFIG MODAL ===== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--secondary);
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid var(--border);
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 1.1rem;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .modal-body {
            padding: 16px;
        }
        
        .config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-input);
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .config-item label {
            font-size: 0.85rem;
        }
        
        .config-item select,
        .config-item input {
            padding: 6px 10px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text-primary);
            font-size: 0.85rem;
        }
        
        .service-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--bg-input);
            border-radius: 8px;
            margin-bottom: 6px;
        }
        
        .service-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .service-status.healthy { background: var(--success); }
        .service-status.offline { background: var(--danger); }
        .service-status.unknown { background: var(--warning); }
        
        .service-name {
            flex: 1;
            font-size: 0.85rem;
        }
        
        .service-action {
            padding: 4px 8px;
            background: var(--primary);
            border: none;
            border-radius: 4px;
            color: white;
            font-size: 0.7rem;
            cursor: pointer;
        }
        
        /* ===== CHAT PANEL (20%) ===== */
        .chat-panel {
            flex: 0 0 20%;
            display: flex;
            flex-direction: column;
            background: var(--secondary);
        }
        
        .chat-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .chat-header .logo {
            font-size: 1.25rem;
            font-weight: 700;
        }
        
        .chat-header .status {
            font-size: 0.75rem;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .chat-header .status::before {
            content: "";
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .message {
            max-width: 95%;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .message.user {
            align-self: flex-end;
            background: var(--primary);
            border-bottom-right-radius: 4px;
        }
        
        .message.assistant {
            align-self: flex-start;
            background: var(--bg-input);
            border-bottom-left-radius: 4px;
        }
        
        .message .timestamp {
            font-size: 0.7rem;
            color: rgba(255,255,255,0.5);
            margin-top: 4px;
        }
        
        .chat-input-container {
            padding: 16px;
            border-top: 1px solid var(--border);
        }
        
        .chat-input-wrapper {
            display: flex;
            gap: 8px;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 16px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 24px;
            color: var(--text-primary);
            font-size: 0.9rem;
            outline: none;
        }
        
        .chat-input:focus {
            border-color: var(--primary);
        }
        
        .chat-input::placeholder {
            color: var(--text-secondary);
        }
        
        .voice-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--primary);
            border: none;
            color: white;
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .voice-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }
        
        .voice-btn.listening {
            background: var(--danger);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .send-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--primary);
            border: none;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .send-btn:hover {
            background: var(--primary-dark);
        }
        
        /* Loading animation */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
            background: var(--bg-input);
            border-radius: 12px;
            width: fit-content;
        }
        
        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: var(--text-secondary);
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out;
        }
        
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes bounce {
            0%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-8px); }
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .app-view { flex: 0 0 70%; }
            .chat-panel { flex: 0 0 30%; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
        
        @media (max-width: 768px) {
            .container { flex-direction: column; }
            .app-view { flex: 1; border-right: none; border-bottom: 1px solid var(--border); }
            .chat-panel { flex: 0 0 300px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- APP VIEW (80%) -->
        <div class="app-view">
            <div class="location-bar" id="location-bar">
                <button class="home-btn" onclick="sendCommand('start')" title="Strona g≈Ç√≥wna">üè†</button>
                <span class="separator">‚Ä∫</span>
                <span class="current-location" id="current-location">Dashboard</span>
                <button class="back-btn" onclick="history.back()" title="Wstecz">‚Üê Wstecz</button>
            </div>
            <div class="app-header" id="app-header">
                <div>
                    <h1 id="app-title">üëã Streamware Voice Dashboard</h1>
                    <div class="subtitle" id="app-subtitle">Powiedz komendƒô aby rozpoczƒÖƒá</div>
                </div>
                <div class="app-actions" id="app-actions">
                    <!-- Dynamic actions -->
                </div>
            </div>
            <div class="app-content" id="app-content">
                <!-- Dynamic content -->
                <div class="welcome-view">
                    <div class="welcome-icon">üé§</div>
                    <h2 class="welcome-title">Witaj w Streamware</h2>
                    <p class="welcome-message">Powiedz komendƒô g≈ÇosowƒÖ lub wpisz w chat.

Przyk≈Çadowe komendy:
‚Ä¢ "Poka≈º faktury" - dokumenty
‚Ä¢ "Poka≈º kamery" - monitoring
‚Ä¢ "Poka≈º sprzeda≈º" - dashboard</p>
                    <div class="command-suggestions">
                        <div class="suggestion-chip" onclick="sendCommand('Poka≈º faktury')">üìÑ Faktury</div>
                        <div class="suggestion-chip" onclick="sendCommand('Poka≈º kamery')">üé• Kamery</div>
                        <div class="suggestion-chip" onclick="sendCommand('Poka≈º sprzeda≈º')">üìä Sprzeda≈º</div>
                        <div class="suggestion-chip" onclick="sendCommand('Pomoc')">‚ùì Pomoc</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- CHAT PANEL (20%) - SIMPLIFIED MINIMAL INTERFACE -->
        <div class="chat-panel">
            <div class="chat-header">
                <div class="logo">üé§ Streamware</div>
                <div class="status" id="connection-status">Po≈ÇƒÖczono</div>
            </div>
            
            <!-- QUICK ACTIONS - context-aware buttons -->
            <div class="quick-actions" id="quick-actions">
                <div class="quick-actions-header">‚ö° Szybkie akcje</div>
                <div class="quick-actions-grid" id="quick-actions-grid">
                    <!-- Dynamic based on current app -->
                </div>
            </div>
            
            <div class="chat-messages" id="chat-messages">
                <div class="message assistant">
                    Cze≈õƒá! Wybierz akcjƒô lub wpisz komendƒô.
                    <div class="timestamp">Teraz</div>
                </div>
            </div>
            
            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <input type="text" class="chat-input" id="chat-input" 
                           placeholder="Wpisz komendƒô..." 
                           onkeypress="handleKeyPress(event)">
                    <button class="voice-btn" id="voice-btn" onclick="toggleVoice()">üé§</button>
                    <button class="send-btn" onclick="sendCurrentInput()">‚û§</button>
                </div>
            </div>
            
            <!-- CONFIG BUTTON -->
            <div class="config-bar">
                <button onclick="showConfig()" class="config-btn" title="Ustawienia">‚öôÔ∏è</button>
                <button onclick="toggleTTS()" class="config-btn" id="tts-btn" title="TTS">üîä</button>
                <button onclick="showLanguageMenu()" class="config-btn" id="lang-btn" title="Jƒôzyk">üáµüá±</button>
                <button onclick="showServices()" class="config-btn" title="Us≈Çugi">üîå</button>
                <button onclick="copyChatToClipboard()" class="config-btn" title="Kopiuj chat">üìã</button>
                <button onclick="clearHistory()" class="config-btn" title="Wyczy≈õƒá">üóëÔ∏è</button>
            </div>
            
            <!-- LANGUAGE MENU -->
            <div id="language-menu" class="language-menu" style="display: none;">
                <div class="language-menu-header">üåê Wybierz jƒôzyk</div>
                <div class="language-options" id="language-options">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <div id="tts-indicator" class="tts-indicator">üîä M√≥wiƒô...</div>
    
    <!-- CONFIG MODAL -->
    <div class="modal-overlay" id="config-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚öôÔ∏è Ustawienia</h3>
                <button class="modal-close" onclick="closeModal('config-modal')">√ó</button>
            </div>
            <div class="modal-body" id="config-modal-body">
                <!-- Dynamic config items -->
            </div>
        </div>
    </div>
    
    <!-- SERVICES MODAL -->
    <div class="modal-overlay" id="services-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üîå Us≈Çugi</h3>
                <button class="modal-close" onclick="closeModal('services-modal')">√ó</button>
            </div>
            <div class="modal-body" id="services-modal-body">
                <!-- Dynamic service items -->
            </div>
        </div>
    </div>
    
    <script>
        // ===== STATE & HISTORY =====
        const clientId = 'client_' + Math.random().toString(36).substr(2, 9);
        let ws = null;
        let isListening = false;
        let recognition = null;
        let currentUser = null;
        let ttsEnabled = true;
        let commandHistory = [];
        let currentView = null;
        
        // ===== URL ROUTING =====
        function updateURL(command, appType) {
            const url = new URL(window.location);
            if (command) {
                url.searchParams.set('cmd', command);
            }
            if (appType) {
                url.searchParams.set('app', appType);
            }
            url.searchParams.set('t', Date.now());
            window.history.pushState({ command, appType }, '', url);
        }
        
        function getURLCommand() {
            const url = new URL(window.location);
            return url.searchParams.get('cmd');
        }
        
        function handlePopState(event) {
            if (event.state && event.state.command) {
                sendCommand(event.state.command, false); // false = don't update URL
            }
        }
        
        window.addEventListener('popstate', handlePopState);
        
        // ===== COMMAND HISTORY =====
        function addToHistory(command, appType, response) {
            const entry = {
                id: Date.now(),
                command,
                appType,
                response: response.substring(0, 100),
                timestamp: new Date().toISOString()
            };
            commandHistory.unshift(entry);
            if (commandHistory.length > 50) commandHistory.pop();
            renderCommandHistory();
            localStorage.setItem('streamware_history', JSON.stringify(commandHistory));
        }
        
        function loadHistory() {
            const saved = localStorage.getItem('streamware_history');
            if (saved) {
                commandHistory = JSON.parse(saved);
                renderCommandHistory();
            }
        }
        
        function renderCommandHistory() {
            const container = document.getElementById('command-history');
            if (!container) return;
            
            container.innerHTML = commandHistory.slice(0, 10).map(entry => `
                <div class="history-item" onclick="sendCommand('${entry.command}')" title="${entry.response}">
                    <span class="history-cmd">${entry.command}</span>
                    <span class="history-app">${entry.appType || 'system'}</span>
                </div>
            `).join('');
        }
        
        function copyChatToClipboard() {
            const messages = document.querySelectorAll('#chat-messages .message');
            let text = '=== STREAMWARE CHAT LOG ===\n';
            text += `Date: ${new Date().toLocaleString()}\n\n`;
            
            messages.forEach(msg => {
                const role = msg.classList.contains('user') ? 'USER' : 'BOT';
                const content = msg.childNodes[0]?.textContent?.trim() || '';
                const time = msg.querySelector('.timestamp')?.textContent || '';
                text += `[${time}] ${role}: ${content}\n`;
            });
            
            navigator.clipboard.writeText(text).then(() => {
                addChatMessage('üìã Chat skopiowany do schowka!', 'assistant');
            }).catch(() => {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                addChatMessage('üìã Chat skopiowany do schowka!', 'assistant');
            });
        }
        
        function clearHistory() {
            commandHistory = [];
            localStorage.removeItem('streamware_history');
            renderCommandHistory();
        }
        
        // ===== WEBSOCKET CONNECTION =====
        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            ws = new WebSocket(`${protocol}//${window.location.host}/ws/${clientId}`);
            
            ws.onopen = () => {
                console.log('WebSocket connected');
                updateConnectionStatus(true);
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                handleServerMessage(data);
            };
            
            ws.onclose = () => {
                console.log('WebSocket disconnected');
                updateConnectionStatus(false);
                setTimeout(connectWebSocket, 3000);
            };
            
            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
            };
        }
        
        function updateConnectionStatus(connected) {
            const statusEl = document.querySelector('.chat-header .status');
            if (connected) {
                statusEl.textContent = 'Po≈ÇƒÖczono';
                statusEl.style.color = 'var(--success)';
            } else {
                statusEl.textContent = 'Roz≈ÇƒÖczono';
                statusEl.style.color = 'var(--danger)';
            }
        }
        
        // ===== MESSAGE HANDLING =====
        function handleServerMessage(data) {
            console.log('Received:', data);
            
            if (data.type === 'welcome') {
                // Initial welcome - render dashboard
                if (data.view) {
                    renderView(data.view);
                }
            } else if (data.type === 'response') {
                // Add assistant message
                addChatMessage(data.response_text, 'assistant');
                
                // Speak the response (TTS)
                if (ttsEnabled && data.response_text) {
                    speak(data.response_text);
                }
                
                // Update URL and history
                const appType = data.intent?.app_type || 'system';
                if (window._lastCommand && window._updateUrl) {
                    updateURL(window._lastCommand, appType);
                    addToHistory(window._lastCommand, appType, data.response_text || '');
                }
                currentView = data.view;
                
                // Update app view
                if (data.view) {
                    renderView(data.view);
                }
            } else if (data.type === 'login_success') {
                currentUser = data.user;
                addChatMessage(`‚úÖ ${data.response_text}`, 'assistant');
                speak(`Zalogowano jako ${data.user.user}`);
                if (data.view) {
                    renderView(data.view);
                }
                updateUserStatus();
            } else if (data.type === 'login_failed') {
                addChatMessage(`‚ùå ${data.response_text}`, 'assistant');
                speak('B≈ÇƒÖd logowania');
            } else if (data.type === 'logout') {
                currentUser = null;
                addChatMessage(`üëã ${data.response_text}`, 'assistant');
                speak('Wylogowano');
                if (data.view) {
                    renderView(data.view);
                }
                updateUserStatus();
            } else if (data.type === 'access_denied') {
                addChatMessage(`üö´ ${data.response_text}`, 'assistant');
                speak('Brak dostƒôpu');
                if (data.view) {
                    renderView(data.view);
                }
            } else if (data.type === 'view_update') {
                renderView(data.view);
            }
        }
        
        function updateUserStatus() {
            const statusEl = document.querySelector('.chat-header .status');
            if (currentUser) {
                statusEl.textContent = `${currentUser.user}`;
                statusEl.style.color = 'var(--success)';
            } else {
                statusEl.textContent = 'Po≈ÇƒÖczono';
                statusEl.style.color = 'var(--success)';
            }
        }
        
        // ===== TEXT-TO-SPEECH (TTS) =====
        function speak(text) {
            if (!('speechSynthesis' in window)) {
                console.warn('TTS not supported');
                return;
            }
            
            // Cancel any ongoing speech
            window.speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'pl-PL';
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            
            // Show TTS indicator
            const indicator = document.getElementById('tts-indicator');
            indicator.classList.add('active');
            
            utterance.onend = () => {
                indicator.classList.remove('active');
            };
            
            utterance.onerror = () => {
                indicator.classList.remove('active');
            };
            
            window.speechSynthesis.speak(utterance);
        }
        
        function toggleTTS() {
            ttsEnabled = !ttsEnabled;
            addChatMessage(ttsEnabled ? 'üîä TTS w≈ÇƒÖczony' : 'üîá TTS wy≈ÇƒÖczony', 'assistant');
        }
        
        // ===== LANGUAGE MANAGEMENT =====
        let currentLanguage = 'pl';
        const languages = [
            { code: 'pl', icon: 'üáµüá±', name: 'Polski', tts: 'pl-PL', stt: 'pl-PL' },
            { code: 'en', icon: 'üá¨üáß', name: 'English', tts: 'en-GB', stt: 'en-GB' },
            { code: 'de', icon: 'üá©üá™', name: 'Deutsch', tts: 'de-DE', stt: 'de-DE' },
            { code: 'fr', icon: 'üá´üá∑', name: 'Fran√ßais', tts: 'fr-FR', stt: 'fr-FR' },
            { code: 'es', icon: 'üá™üá∏', name: 'Espa√±ol', tts: 'es-ES', stt: 'es-ES' },
            { code: 'it', icon: 'üáÆüáπ', name: 'Italiano', tts: 'it-IT', stt: 'it-IT' },
            { code: 'uk', icon: 'üá∫üá¶', name: '–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞', tts: 'uk-UA', stt: 'uk-UA' },
            { code: 'cs', icon: 'üá®üáø', name: 'ƒåe≈°tina', tts: 'cs-CZ', stt: 'cs-CZ' },
            { code: 'nl', icon: 'üá≥üá±', name: 'Nederlands', tts: 'nl-NL', stt: 'nl-NL' },
            { code: 'sv', icon: 'üá∏üá™', name: 'Svenska', tts: 'sv-SE', stt: 'sv-SE' },
            { code: 'no', icon: 'üá≥üá¥', name: 'Norsk', tts: 'nb-NO', stt: 'nb-NO' },
            { code: 'da', icon: 'üá©üá∞', name: 'Dansk', tts: 'da-DK', stt: 'da-DK' },
        ];
        
        function initLanguageMenu() {
            const optionsEl = document.getElementById('language-options');
            if (!optionsEl) return;
            
            optionsEl.innerHTML = languages.map(lang => `
                <div class="lang-option ${lang.code === currentLanguage ? 'active' : ''}" 
                     onclick="setLanguage('${lang.code}')" title="${lang.name}">
                    <span class="flag">${lang.icon}</span>
                    <span class="name">${lang.name}</span>
                </div>
            `).join('');
        }
        
        function showLanguageMenu() {
            const menu = document.getElementById('language-menu');
            if (menu.style.display === 'none') {
                menu.style.display = 'block';
                initLanguageMenu();
            } else {
                menu.style.display = 'none';
            }
        }
        
        function setLanguage(langCode) {
            const lang = languages.find(l => l.code === langCode);
            if (!lang) return;
            
            currentLanguage = langCode;
            
            // Update button icon
            document.getElementById('lang-btn').textContent = lang.icon;
            
            // Update STT language
            if (recognition) {
                recognition.lang = lang.stt;
            }
            
            // Send to server
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'set_language',
                    language: langCode
                }));
            }
            
            // Hide menu and show confirmation
            document.getElementById('language-menu').style.display = 'none';
            addChatMessage(`${lang.icon} Jƒôzyk zmieniony na: ${lang.name}`, 'assistant');
            
            // Update menu active state
            initLanguageMenu();
        }
        
        // Close language menu when clicking outside
        document.addEventListener('click', (e) => {
            const menu = document.getElementById('language-menu');
            const btn = document.getElementById('lang-btn');
            if (menu && !menu.contains(e.target) && e.target !== btn) {
                menu.style.display = 'none';
            }
        });
        
        function addChatMessage(text, sender) {
            const messagesEl = document.getElementById('chat-messages');
            const messageEl = document.createElement('div');
            messageEl.className = `message ${sender}`;
            
            const time = new Date().toLocaleTimeString('pl-PL', { hour: '2-digit', minute: '2-digit' });
            messageEl.innerHTML = `${text}<div class="timestamp">${time}</div>`;
            
            messagesEl.appendChild(messageEl);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }
        
        function sendCommand(text, updateUrl = true) {
            if (!text.trim()) return;
            
            // Add user message to chat
            addChatMessage(text, 'user');
            
            // Send to server
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'voice_command',
                    text: text
                }));
            }
            
            // Clear input
            document.getElementById('chat-input').value = '';
            
            // Store last command for URL update after response
            window._lastCommand = text;
            window._updateUrl = updateUrl;
        }
        
        function sendCurrentInput() {
            const input = document.getElementById('chat-input');
            sendCommand(input.value);
        }
        
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendCurrentInput();
            }
        }
        
        // ===== VIEW RENDERING =====
        function renderView(view) {
            const contentEl = document.getElementById('app-content');
            const titleEl = document.getElementById('app-title');
            const subtitleEl = document.getElementById('app-subtitle');
            const actionsEl = document.getElementById('app-actions');
            
            // Update header
            titleEl.textContent = view.title || 'Streamware';
            subtitleEl.textContent = view.subtitle || '';
            
            // Render actions + contextual skills for current app
            actionsEl.innerHTML = '';
            
            // Add contextual skills based on app type
            const appSkills = getAppSkills(view.type);
            if (appSkills && appSkills.length > 0) {
                appSkills.slice(0, 6).forEach(skill => {
                    const btn = document.createElement('button');
                    btn.className = 'skill-chip';
                    btn.textContent = skill.name || skill.cmd;
                    btn.title = skill.desc || skill.cmd;
                    btn.onclick = () => sendCommand(skill.cmd);
                    actionsEl.appendChild(btn);
                });
            }
            
            // Add view-specific actions
            if (view.actions) {
                view.actions.forEach(action => {
                    const btn = document.createElement('button');
                    btn.innerHTML = `${action.icon} ${action.label}`;
                    btn.onclick = () => handleAction(action.id, view.type);
                    actionsEl.appendChild(btn);
                });
            }
            
            // Render content based on view type
            if (view.type === 'welcome') {
                contentEl.innerHTML = renderAppsDashboard(view);
            } else if (view.type === 'documents') {
                contentEl.innerHTML = renderDocumentsView(view);
            } else if (view.type === 'cameras') {
                contentEl.innerHTML = renderCamerasView(view);
            } else if (view.type === 'sales') {
                contentEl.innerHTML = renderSalesView(view);
            } else if (view.type === 'home') {
                contentEl.innerHTML = renderHomeView(view);
            } else if (view.type === 'analytics') {
                contentEl.innerHTML = renderAnalyticsView(view);
            } else if (view.type === 'internet') {
                contentEl.innerHTML = renderInternetView(view);
            } else if (view.type === 'system' && view.view === 'help') {
                contentEl.innerHTML = renderHelpView(view);
            } else if (view.type === 'system' && view.view === 'login') {
                contentEl.innerHTML = renderLoginView(view);
            } else if (view.type === 'system') {
                contentEl.innerHTML = renderSystemView(view);
            } else if (view.type === 'files') {
                contentEl.innerHTML = renderFilesView(view);
            } else if (view.type === 'cloud_storage') {
                contentEl.innerHTML = renderCloudStorageView(view);
            } else if (view.type === 'curllm') {
                contentEl.innerHTML = renderCurllmView(view);
            } else if (view.type === 'registry') {
                contentEl.innerHTML = renderRegistryView(view);
            } else if (view.view === 'empty_state') {
                contentEl.innerHTML = renderEmptyStateView(view);
            } else if (view.type === 'empty') {
                contentEl.innerHTML = renderAppsDashboard(view);
            } else {
                contentEl.innerHTML = renderGenericView(view);
            }
        }
        
        function renderEmptyStateView(view) {
            let html = '<div class="empty-state-view">';
            
            // Empty state message
            html += `
                <div class="empty-state-box">
                    <div class="empty-icon">üì≠</div>
                    <h2>${view.empty_message || 'Brak danych'}</h2>
                    <p class="empty-instructions">${view.empty_instructions || ''}</p>
                </div>
            `;
            
            // Stats (showing zeros)
            if (view.stats) {
                html += '<div class="stats-grid empty">';
                view.stats.forEach(stat => {
                    html += `
                        <div class="stat-card">
                            <div class="stat-icon">${stat.icon}</div>
                            <div class="stat-value">${stat.value}</div>
                            <div class="stat-label">${stat.label}</div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Quick actions to get started
            if (view.quick_actions) {
                html += '<div class="quick-actions-section"><h3>üöÄ Rozpocznij</h3><div class="quick-actions-grid">';
                view.quick_actions.forEach(action => {
                    html += `<button class="quick-action-btn primary" onclick="sendCommand('${action.cmd}')">${action.icon || ''} ${action.label}</button>`;
                });
                html += '</div></div>';
            }
            
            html += '</div>';
            return html;
        }
        
        function renderFilesView(view) {
            let html = '<div class="files-dashboard">';
            
            // Stats
            if (view.stats) {
                html += '<div class="stats-grid">';
                view.stats.forEach(stat => {
                    html += `
                        <div class="stat-card">
                            <div class="stat-icon">${stat.icon}</div>
                            <div class="stat-value">${stat.value}</div>
                            <div class="stat-label">${stat.label}</div>
                            ${stat.detail ? `<div class="stat-detail">${stat.detail}</div>` : ''}
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Quick actions
            if (view.quick_actions) {
                html += '<div class="quick-actions-grid">';
                view.quick_actions.forEach(action => {
                    html += `<button class="quick-action-btn" onclick="sendCommand('${action.cmd}')">${action.icon || ''} ${action.label}</button>`;
                });
                html += '</div>';
            }
            
            // Recent files
            if (view.recent_files && view.recent_files.length > 0) {
                html += '<div class="recent-files"><h3>üïê Ostatnie pliki</h3><div class="files-list">';
                view.recent_files.forEach(file => {
                    const ext = file.name.split('.').pop().toLowerCase();
                    const icon = {'pdf': 'üìÑ', 'doc': 'üìù', 'docx': 'üìù', 'xls': 'üìä', 'xlsx': 'üìä', 'jpg': 'üñºÔ∏è', 'png': 'üñºÔ∏è', 'zip': 'üì¶'}[ext] || 'üìÑ';
                    html += `
                        <div class="file-item" onclick="sendCommand('otw√≥rz ${file.name}')">
                            <span class="file-icon">${icon}</span>
                            <span class="file-name">${file.name}</span>
                            <span class="file-size">${file.size}</span>
                            <span class="file-date">${file.modified}</span>
                        </div>
                    `;
                });
                html += '</div></div>';
            }
            
            html += '</div>';
            return html;
        }
        
        function renderCloudStorageView(view) {
            let html = '<div class="cloud-dashboard">';
            
            // Check if this is a connect form
            if (view.view === 'connect_form') {
                html += `
                    <div class="connect-form-container">
                        <div class="form-header">
                            <h2>${view.title}</h2>
                            <p>${view.instructions}</p>
                        </div>
                        <form id="cloud-connect-form" class="connect-form">
                            <input type="hidden" name="provider_id" value="${view.provider_id}">
                `;
                
                view.form_fields.forEach(field => {
                    html += `
                        <div class="form-group">
                            <label for="${field.id}">${field.label}</label>
                            <input type="${field.type}" id="${field.id}" name="${field.id}" placeholder="${field.label}" required>
                        </div>
                    `;
                });
                
                html += `
                        </form>
                        <div class="form-actions">
                            <button class="btn-primary" onclick="saveCloudConnection('${view.provider_id}')">üíæ Zapisz po≈ÇƒÖczenie</button>
                            <button class="btn-secondary" onclick="sendCommand('chmura')">‚ùå Anuluj</button>
                        </div>
                    </div>
                `;
                html += '</div>';
                return html;
            }
            
            // Stats
            if (view.stats) {
                html += '<div class="stats-grid">';
                view.stats.forEach(stat => {
                    html += `
                        <div class="stat-card">
                            <div class="stat-icon">${stat.icon}</div>
                            <div class="stat-value">${stat.value}</div>
                            <div class="stat-label">${stat.label}</div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Providers
            if (view.providers) {
                html += '<div class="providers-grid">';
                view.providers.forEach(provider => {
                    const statusClass = provider.status === 'connected' ? 'connected' : 'disconnected';
                    html += `
                        <div class="provider-card ${statusClass}" onclick="sendCommand('po≈ÇƒÖcz ${provider.id}')">
                            <div class="provider-icon">${provider.icon}</div>
                            <div class="provider-name">${provider.name}</div>
                            <div class="provider-status">${provider.status === 'connected' ? '‚úÖ Po≈ÇƒÖczony' : 'üîó Po≈ÇƒÖcz'}</div>
                            ${provider.last_sync ? `<div class="provider-sync">Sync: ${provider.last_sync}</div>` : ''}
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Quick actions
            if (view.quick_actions) {
                html += '<div class="quick-actions-grid">';
                view.quick_actions.forEach(action => {
                    html += `<button class="quick-action-btn" onclick="sendCommand('${action.cmd}')">${action.icon || ''} ${action.label}</button>`;
                });
                html += '</div>';
            }
            
            html += '</div>';
            return html;
        }
        
        function saveCloudConnection(providerId) {
            const form = document.getElementById('cloud-connect-form');
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => data[key] = value);
            
            // Send to backend via action
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'action',
                    app_type: 'cloud_storage',
                    action: 'save_connection',
                    params: {
                        provider_id: providerId,
                        ...data
                    }
                }));
                addChatMessage('bot', `Zapisujƒô po≈ÇƒÖczenie z ${providerId}...`);
            }
        }
        
        function renderRegistryView(view) {
            let html = '<div class="registry-dashboard">';
            
            // Stats
            if (view.stats) {
                html += '<div class="stats-grid">';
                view.stats.forEach(stat => {
                    html += `
                        <div class="stat-card">
                            <div class="stat-icon">${stat.icon}</div>
                            <div class="stat-value">${stat.value}</div>
                            <div class="stat-label">${stat.label}</div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Registries list
            if (view.registries && view.registries.length > 0) {
                html += '<div class="registries-list"><h3>üì¶ Rejestry</h3><div class="registries-grid">';
                view.registries.forEach(reg => {
                    const statusIcon = reg.enabled ? '‚úÖ' : '‚è∏Ô∏è';
                    const typeIcon = {'local': 'üìÅ', 'docker': 'üê≥', 'git': 'üìÇ', 'http': 'üåê', 'npm': 'üì¶', 'pip': 'üêç'}[reg.type] || 'üì¶';
                    html += `
                        <div class="registry-card ${reg.enabled ? 'enabled' : 'disabled'}">
                            <div class="registry-header">
                                <span class="registry-icon">${typeIcon}</span>
                                <span class="registry-name">${reg.name}</span>
                                <span class="registry-status">${statusIcon}</span>
                            </div>
                            <div class="registry-info">
                                <div class="registry-type">${reg.type}</div>
                                <div class="registry-url">${reg.url}</div>
                                <div class="registry-apps">${reg.apps_count} apps</div>
                            </div>
                            <div class="registry-actions">
                                <button onclick="sendCommand('synchronizuj ${reg.id}')">üîÑ Sync</button>
                            </div>
                        </div>
                    `;
                });
                html += '</div></div>';
            } else {
                html += '<div class="empty-registries"><p>Brak skonfigurowanych rejestr√≥w</p></div>';
            }
            
            // Quick actions
            if (view.quick_actions) {
                html += '<div class="quick-actions-grid">';
                view.quick_actions.forEach(action => {
                    html += `<button class="quick-action-btn" onclick="sendCommand('${action.cmd}')">${action.icon || ''} ${action.label}</button>`;
                });
                html += '</div>';
            }
            
            html += '</div>';
            return html;
        }
        
        function renderCurllmView(view) {
            let html = '<div class="curllm-dashboard">';
            
            // Stats
            if (view.stats) {
                html += '<div class="stats-grid">';
                view.stats.forEach(stat => {
                    html += `
                        <div class="stat-card">
                            <div class="stat-icon">${stat.icon}</div>
                            <div class="stat-value">${stat.value}</div>
                            <div class="stat-label">${stat.label}</div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Models
            if (view.models && view.models.length > 0) {
                html += '<div class="models-list"><h3>üß† Dostƒôpne modele</h3><div class="models-grid">';
                view.models.forEach(model => {
                    html += `<button class="model-btn" onclick="sendCommand('zmie≈Ñ model ${model}')">${model}</button>`;
                });
                html += '</div></div>';
            }
            
            // Quick actions
            if (view.quick_actions) {
                html += '<div class="quick-actions-grid">';
                view.quick_actions.forEach(action => {
                    html += `<button class="quick-action-btn" onclick="sendCommand('${action.cmd}')">${action.icon || ''} ${action.label}</button>`;
                });
                html += '</div>';
            }
            
            html += '</div>';
            return html;
        }
        
        function renderAppsDashboard(view) {
            let html = '<div class="apps-dashboard">';
            
            // User info bar if logged in
            if (currentUser) {
                html += `
                    <div class="user-bar">
                        <span>üë§ ${currentUser.user} (${currentUser.role})</span>
                        <button onclick="sendCommand('logout')" class="logout-btn">Wyloguj</button>
                    </div>
                `;
            } else {
                html += `
                    <div class="user-bar guest">
                        <span>üîì Niezalogowany - pe≈Çny dostƒôp demo</span>
                        <button onclick="sendCommand('login')" class="login-btn">üîê Zaloguj</button>
                    </div>
                `;
            }
            
            // Quick commands
            html += `
                <div class="quick-commands">
                    <button onclick="sendCommand('pomoc')" class="quick-cmd">üìã Pomoc</button>
                    <button onclick="sendCommand('login')" class="quick-cmd">üîê Zaloguj</button>
                    <button onclick="sendCommand('status')" class="quick-cmd">‚öôÔ∏è Status</button>
                </div>
            `;
            
            // Apps grid
            if (view.apps) {
                html += '<div class="apps-grid">';
                
                for (const [appKey, app] of Object.entries(view.apps)) {
                    html += `
                        <div class="app-card" style="border-color: ${app.color}">
                            <div class="app-card-header" style="background: ${app.color}20">
                                <span class="app-icon">${app.icon}</span>
                                <div class="app-info">
                                    <h3>${app.name}</h3>
                                    <p>${app.description}</p>
                                </div>
                            </div>
                            <div class="app-skills">
                                ${app.skills.map(skill => `
                                    <button class="skill-btn" onclick="sendCommand('${skill.cmd}')" title="${skill.desc}">
                                        ${skill.name}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                
                html += '</div>';
            }
            
            html += `<div class="dashboard-footer">
                <p>üí° Kliknij przycisk lub wpisz komendƒô w chat ‚Ä¢ ${view.total_skills || 50}+ dostƒôpnych komend</p>
            </div>`;
            
            html += '</div>';
            return html;
        }
        
        function renderLoginView(view) {
            return `
                <div class="login-view">
                    <div class="login-box">
                        <h2>üîê Logowanie do systemu</h2>
                        <p>Wpisz w chat: <code>login [u≈ºytkownik] [has≈Ço]</code></p>
                        <div class="demo-users">
                            <h4>U≈ºytkownicy demo:</h4>
                            <div class="user-list">
                                <div class="user-item" onclick="sendCommand('login admin admin123')">
                                    <strong>admin</strong> / admin123<br>
                                    <small>Pe≈Çny dostƒôp</small>
                                </div>
                                <div class="user-item" onclick="sendCommand('login kowalski biuro123')">
                                    <strong>kowalski</strong> / biuro123<br>
                                    <small>Biuro (dokumenty, sprzeda≈º)</small>
                                </div>
                                <div class="user-item" onclick="sendCommand('login dozorca ochrona123')">
                                    <strong>dozorca</strong> / ochrona123<br>
                                    <small>Ochrona (kamery, smart home)</small>
                                </div>
                                <div class="user-item" onclick="sendCommand('login manager manager123')">
                                    <strong>manager</strong> / manager123<br>
                                    <small>Manager (biuro + kamery)</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderHomeView(view) {
            let html = '';
            if (view.stats) {
                html += '<div class="stats-grid">';
                view.stats.forEach(stat => {
                    html += `
                        <div class="stat-card">
                            <div class="stat-icon">${stat.icon}</div>
                            <div class="stat-content">
                                <div class="stat-value">${stat.value}</div>
                                <div class="stat-label">${stat.label}</div>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            if (view.rooms) {
                html += '<div class="rooms-grid">';
                view.rooms.forEach(room => {
                    html += `
                        <div class="room-card">
                            <h4>${room.room}</h4>
                            <div class="room-stats">
                                <span>üå°Ô∏è ${room.temperature}¬∞C</span>
                                <span>üíß ${room.humidity}%</span>
                                <span>${room.light_on ? 'üí°' : 'üåô'}</span>
                                <span>${room.motion ? 'üö∂' : ''}</span>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            return html;
        }
        
        function renderAnalyticsView(view) {
            let html = '';
            if (view.stats) {
                html += '<div class="stats-grid">';
                view.stats.forEach(stat => {
                    html += `
                        <div class="stat-card">
                            <div class="stat-icon">${stat.icon}</div>
                            <div class="stat-content">
                                <div class="stat-value">${stat.value}</div>
                                <div class="stat-label">${stat.label}</div>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            if (view.metrics) {
                html += '<div class="metrics-grid">';
                view.metrics.forEach(m => {
                    html += `
                        <div class="metric-card">
                            <div class="metric-name">${m.name}</div>
                            <div class="metric-value">${m.value}</div>
                            <div class="metric-change">${m.change}</div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            return html;
        }
        
        function renderInternetView(view) {
            let html = '';
            if (view.stats) {
                html += '<div class="stats-grid">';
                view.stats.forEach(stat => {
                    html += `
                        <div class="stat-card">
                            <div class="stat-icon">${stat.icon}</div>
                            <div class="stat-content">
                                <div class="stat-value">${stat.value}</div>
                                <div class="stat-label">${stat.label}</div>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            if (view.services) {
                html += '<div class="services-grid">';
                view.services.forEach(s => {
                    html += `
                        <div class="service-card">
                            <span class="service-icon">${s.icon}</span>
                            <span class="service-name">${s.name}</span>
                            <span class="service-status ${s.status === 'active' ? 'active' : ''}">${s.status}</span>
                        </div>
                    `;
                });
                html += '</div>';
            }
            if (view.message) {
                html += `<div class="info-message">${view.message}</div>`;
            }
            return html;
        }
        
        function renderSystemView(view) {
            return `
                <div class="system-view">
                    <h2>${view.title}</h2>
                    <p>${view.message || ''}</p>
                </div>
            `;
        }
        
        function renderGenericView(view) {
            let html = '';
            if (view.stats) {
                html += '<div class="stats-grid">';
                view.stats.forEach(stat => {
                    html += `
                        <div class="stat-card">
                            <div class="stat-icon">${stat.icon}</div>
                            <div class="stat-content">
                                <div class="stat-value">${stat.value}</div>
                                <div class="stat-label">${stat.label}</div>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            if (view.message) {
                html += `<div class="info-message">${view.message}</div>`;
            }
            return html;
        }
        
        function renderDocumentsView(view) {
            let html = '';
            
            // Stats
            if (view.stats) {
                html += '<div class="stats-grid">';
                view.stats.forEach(stat => {
                    html += `
                        <div class="stat-card">
                            <div class="stat-icon">${stat.icon}</div>
                            <div class="stat-content">
                                <div class="stat-value">${stat.value}</div>
                                <div class="stat-label">${stat.label}</div>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Table
            if (view.data && view.columns) {
                html += '<div class="data-table-container"><table class="data-table">';
                
                // Header
                html += '<thead><tr>';
                view.columns.forEach(col => {
                    html += `<th style="width: ${col.width || 'auto'}">${col.label}</th>`;
                });
                html += '</tr></thead>';
                
                // Body
                html += '<tbody>';
                view.data.forEach(row => {
                    html += '<tr>';
                    view.columns.forEach(col => {
                        let value = row[col.key];
                        
                        if (col.format === 'currency') {
                            value = formatCurrency(value);
                        } else if (col.format === 'badge') {
                            value = renderBadge(value);
                        }
                        
                        html += `<td>${value}</td>`;
                    });
                    html += '</tr>';
                });
                html += '</tbody></table></div>';
            }
            
            return html;
        }
        
        function renderCamerasView(view) {
            let html = '';
            
            // Stats
            if (view.stats) {
                html += '<div class="stats-grid">';
                view.stats.forEach(stat => {
                    html += `
                        <div class="stat-card">
                            <div class="stat-icon">${stat.icon}</div>
                            <div class="stat-content">
                                <div class="stat-value">${stat.value}</div>
                                <div class="stat-label">${stat.label}</div>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Camera grid
            if (view.cameras) {
                html += '<div class="camera-grid">';
                view.cameras.forEach(camera => {
                    const isOffline = camera.status === 'offline';
                    const hasAlerts = camera.alerts && camera.alerts.length > 0;
                    
                    html += `
                        <div class="camera-card">
                            <div class="camera-feed ${isOffline ? 'offline' : ''}">
                                <div class="status-indicator ${isOffline ? 'offline' : ''}"></div>
                                ${camera.objects_detected > 0 ? `<div class="detection-badge">üë§ ${camera.objects_detected} wykryto</div>` : ''}
                                <div class="camera-icon">${isOffline ? 'üìµ' : 'üìπ'}</div>
                                <div style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 8px;">
                                    ${isOffline ? 'Brak po≈ÇƒÖczenia' : 'Symulacja streamu'}
                                </div>
                            </div>
                            <div class="camera-info">
                                <div>
                                    <div class="camera-name">${camera.name}</div>
                                    <div class="camera-meta">Ostatni ruch: ${camera.last_motion}</div>
                                </div>
                                <div class="camera-meta">${camera.status}</div>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            return html;
        }
        
        function renderSalesView(view) {
            let html = '';
            
            // Stats
            if (view.stats) {
                html += '<div class="stats-grid">';
                view.stats.forEach(stat => {
                    html += `
                        <div class="stat-card">
                            <div class="stat-icon">${stat.icon}</div>
                            <div class="stat-content">
                                <div class="stat-value">${stat.value}</div>
                                <div class="stat-label">${stat.label}</div>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Chart
            if (view.chart) {
                const maxValue = Math.max(...view.chart.datasets[0].data);
                const colors = view.chart.datasets[0].backgroundColor;
                
                html += '<div class="chart-container">';
                html += '<div class="chart-title">üìä Sprzeda≈º wg region√≥w</div>';
                html += '<div class="bar-chart">';
                
                view.chart.labels.forEach((label, i) => {
                    const value = view.chart.datasets[0].data[i];
                    const height = (value / maxValue) * 160;
                    const color = colors[i % colors.length];
                    
                    html += `
                        <div class="bar-item">
                            <div class="bar-value">${formatCurrency(value)}</div>
                            <div class="bar" style="height: ${height}px; background: ${color};"></div>
                            <div class="bar-label">${label}</div>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            }
            
            // Table
            if (view.table) {
                html += '<div class="data-table-container"><table class="data-table">';
                
                html += '<thead><tr>';
                view.table.columns.forEach(col => {
                    html += `<th>${col.label}</th>`;
                });
                html += '</tr></thead>';
                
                html += '<tbody>';
                view.table.data.forEach(row => {
                    html += '<tr>';
                    view.table.columns.forEach(col => {
                        let value = row[col.key];
                        
                        if (col.format === 'currency') {
                            value = formatCurrency(value);
                        } else if (col.format === 'percent') {
                            const isPositive = value >= 0;
                            value = `<span style="color: ${isPositive ? 'var(--success)' : 'var(--danger)'}">${isPositive ? '+' : ''}${value}%</span>`;
                        }
                        
                        html += `<td>${value}</td>`;
                    });
                    html += '</tr>';
                });
                html += '</tbody></table></div>';
            }
            
            return html;
        }
        
        function renderHelpView(view) {
            let html = '<div class="help-grid">';
            
            view.commands.forEach(cat => {
                html += `
                    <div class="help-category">
                        <h3>${cat.category}</h3>
                        <ul class="help-commands">
                            ${cat.commands.map(cmd => `<li onclick="sendCommand('${cmd}')">${cmd}</li>`).join('')}
                        </ul>
                    </div>
                `;
            });
            
            html += '</div>';
            return html;
        }
        
        function renderWelcomeView(view) {
            return `
                <div class="welcome-view">
                    <div class="welcome-icon">üé§</div>
                    <h2 class="welcome-title">${view.title || 'Witaj w Streamware'}</h2>
                    <p class="welcome-message">${view.message || 'Powiedz komendƒô'}</p>
                    <div class="command-suggestions">
                        <div class="suggestion-chip" onclick="sendCommand('Poka≈º faktury')">üìÑ Faktury</div>
                        <div class="suggestion-chip" onclick="sendCommand('Poka≈º kamery')">üé• Kamery</div>
                        <div class="suggestion-chip" onclick="sendCommand('Poka≈º sprzeda≈º')">üìä Sprzeda≈º</div>
                        <div class="suggestion-chip" onclick="sendCommand('Pomoc')">‚ùì Pomoc</div>
                    </div>
                </div>
            `;
        }
        
        // ===== HELPERS =====
        function formatCurrency(value) {
            return new Intl.NumberFormat('pl-PL', { 
                style: 'currency', 
                currency: 'PLN',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        }
        
        function renderBadge(status) {
            const classes = {
                'Nowa': 'badge-info',
                'Zweryfikowana': 'badge-warning',
                'Do zap≈Çaty': 'badge-danger',
                'Zap≈Çacona': 'badge-success'
            };
            return `<span class="badge ${classes[status] || 'badge-info'}">${status}</span>`;
        }
        
        function handleAction(actionId, appType) {
            sendCommand(actionId);
        }
        
        // Get contextual skills for app type
        function getAppSkills(appType) {
            const skills = {
                'internet': [
                    {cmd: 'pogoda', name: 'üå§Ô∏è Pogoda', desc: 'Aktualna pogoda'},
                    {cmd: 'pogoda krak√≥w', name: 'üìç Krak√≥w', desc: 'Pogoda Krak√≥w'},
                    {cmd: 'pogoda gda≈Ñsk', name: 'üìç Gda≈Ñsk', desc: 'Pogoda Gda≈Ñsk'},
                    {cmd: 'bitcoin', name: '‚Çø Bitcoin', desc: 'Kurs Bitcoin'},
                    {cmd: 'rss', name: 'üì∞ RSS', desc: 'Kana≈Çy RSS'},
                    {cmd: 'integracje', name: 'üîå Status', desc: 'Status integracji'},
                ],
                'documents': [
                    {cmd: 'poka≈º faktury', name: 'üìÑ Faktury', desc: 'Lista faktur'},
                    {cmd: 'suma faktur', name: 'üí∞ Suma', desc: 'Suma faktur'},
                    {cmd: 'faktury do zap≈Çaty', name: '‚è∞ Do zap≈Çaty', desc: 'Nieop≈Çacone'},
                    {cmd: 'zeskanuj fakturƒô', name: 'üì∑ Skanuj', desc: 'Skanuj dokument'},
                    {cmd: 'eksportuj do excel', name: 'üìä Eksport', desc: 'Eksport Excel'},
                ],
                'cameras': [
                    {cmd: 'poka≈º kamery', name: 'üé• Kamery', desc: 'Wszystkie kamery'},
                    {cmd: 'gdzie ruch', name: 'üëÅÔ∏è Ruch', desc: 'Wykryty ruch'},
                    {cmd: 'alerty', name: 'üö® Alerty', desc: 'Aktywne alerty'},
                    {cmd: 'parking', name: 'üÖøÔ∏è Parking', desc: 'Kamery parkingu'},
                    {cmd: 'nagraj', name: '‚è∫Ô∏è Nagrywaj', desc: 'Rozpocznij nagrywanie'},
                ],
                'sales': [
                    {cmd: 'poka≈º sprzeda≈º', name: 'üìä Dashboard', desc: 'Dashboard sprzeda≈ºy'},
                    {cmd: 'raport', name: 'üìã Raport', desc: 'Generuj raport'},
                    {cmd: 'top produkty', name: 'üèÜ Top', desc: 'Najlepsze produkty'},
                    {cmd: 'kpi', name: 'üìà KPI', desc: 'Wska≈∫niki'},
                    {cmd: 'prognoza', name: 'üîÆ Prognoza', desc: 'Prognoza sprzeda≈ºy'},
                ],
                'home': [
                    {cmd: 'temperatura', name: 'üå°Ô∏è Temp', desc: 'Temperatura'},
                    {cmd: 'o≈õwietlenie', name: 'üí° ≈öwiat≈Ça', desc: 'Sterowanie ≈õwiat≈Çem'},
                    {cmd: 'alarm', name: 'üö® Alarm', desc: 'System alarmowy'},
                    {cmd: 'energia', name: '‚ö° Energia', desc: 'Zu≈ºycie energii'},
                ],
                'analytics': [
                    {cmd: 'analiza', name: 'üìà Analiza', desc: 'Dashboard'},
                    {cmd: 'wykres', name: 'üìä Wykres', desc: 'Generuj wykres'},
                    {cmd: 'anomalie', name: '‚ö†Ô∏è Anomalie', desc: 'Wykryj anomalie'},
                    {cmd: 'predykcja', name: 'üîÆ Predykcja', desc: 'AI prognoza'},
                ],
                'services': [
                    {cmd: 'us≈Çugi', name: 'üîß Lista', desc: 'Lista us≈Çug'},
                    {cmd: 'docker', name: 'üê≥ Docker', desc: 'Kontenery'},
                    {cmd: 'systemctl', name: '‚öôÔ∏è Systemd', desc: 'Us≈Çugi systemd'},
                ],
                'monitoring': [
                    {cmd: 'cpu', name: 'üíª CPU', desc: 'U≈ºycie CPU'},
                    {cmd: 'pamiƒôƒá', name: 'üß† RAM', desc: 'U≈ºycie pamiƒôci'},
                    {cmd: 'dysk', name: 'üíæ Dysk', desc: 'U≈ºycie dysku'},
                    {cmd: 'procesy', name: 'üìã Procesy', desc: 'Lista proces√≥w'},
                ],
                'backup': [
                    {cmd: 'backup', name: 'üíæ Utw√≥rz', desc: 'Utw√≥rz kopiƒô'},
                    {cmd: 'lista kopii', name: 'üìã Lista', desc: 'Lista kopii'},
                ],
                'system': [
                    {cmd: 'pomoc', name: '‚ùì Pomoc', desc: 'Lista komend'},
                    {cmd: 'status', name: '‚öôÔ∏è Status', desc: 'Status systemu'},
                    {cmd: 'start', name: 'üè† Start', desc: 'Dashboard'},
                ],
            };
            return skills[appType] || [];
        }
        
        // ===== VOICE RECOGNITION =====
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.lang = 'pl-PL';
                recognition.continuous = false;
                recognition.interimResults = false;
                
                recognition.onstart = () => {
                    isListening = true;
                    document.getElementById('voice-btn').classList.add('listening');
                };
                
                recognition.onend = () => {
                    isListening = false;
                    document.getElementById('voice-btn').classList.remove('listening');
                };
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    sendCommand(transcript);
                };
                
                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    isListening = false;
                    document.getElementById('voice-btn').classList.remove('listening');
                };
            }
        }
        
        function toggleVoice() {
            if (!recognition) {
                alert('Rozpoznawanie g≈Çosu nie jest wspierane w tej przeglƒÖdarce. U≈ºyj Chrome.');
                return;
            }
            
            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }
        
        // ===== LOCATION BAR UPDATE =====
        function updateLocationBar(view) {
            const locationEl = document.getElementById('current-location');
            if (!locationEl) return;
            
            const titles = {
                'welcome': 'Dashboard',
                'documents': 'üìÑ Dokumenty',
                'cameras': 'üé• Monitoring',
                'sales': 'üìä Sprzeda≈º',
                'home': 'üè† Smart Home',
                'analytics': 'üìà Analityka',
                'internet': 'üåê Internet',
                'system': '‚öôÔ∏è System'
            };
            
            locationEl.textContent = titles[view?.type] || view?.title || 'Dashboard';
            
            // Update quick actions based on current app
            updateQuickActions(view?.type || 'welcome');
        }
        
        // ===== QUICK ACTIONS - Context-aware commands =====
        const APP_QUICK_ACTIONS = {
            'welcome': [
                {cmd: 'poka≈º faktury', label: 'üìÑ Faktury'},
                {cmd: 'poka≈º kamery', label: 'üé• Kamery'},
                {cmd: 'poka≈º sprzeda≈º', label: 'üìä Sprzeda≈º'},
                {cmd: 'pogoda', label: 'üå§Ô∏è Pogoda'}
            ],
            'documents': [
                {cmd: 'poka≈º faktury', label: 'üìÑ Faktury'},
                {cmd: 'zeskanuj fakturƒô', label: 'üì∑ Skanuj'},
                {cmd: 'suma faktur', label: 'üí∞ Suma'},
                {cmd: 'eksportuj do excel', label: 'üìä Export'}
            ],
            'cameras': [
                {cmd: 'poka≈º kamery', label: 'üìπ Wszystkie'},
                {cmd: 'gdzie ruch', label: 'üèÉ Ruch'},
                {cmd: 'alerty', label: '‚ö†Ô∏è Alerty'},
                {cmd: 'parking', label: 'üÖøÔ∏è Parking'}
            ],
            'sales': [
                {cmd: 'poka≈º sprzeda≈º', label: 'üìä Dashboard'},
                {cmd: 'raport', label: 'üìã Raport'},
                {cmd: 'top produkty', label: 'üèÜ Top'},
                {cmd: 'prognoza', label: 'üìà Prognoza'}
            ],
            'home': [
                {cmd: 'temperatura', label: 'üå°Ô∏è Temp'},
                {cmd: 'o≈õwietlenie', label: 'üí° ≈öwiat≈Ça'},
                {cmd: 'alarm', label: 'üö® Alarm'},
                {cmd: 'energia', label: '‚ö° Energia'}
            ],
            'analytics': [
                {cmd: 'analiza', label: 'üìä Analiza'},
                {cmd: 'raport dzienny', label: 'üìÖ Dzienny'},
                {cmd: 'anomalie', label: 'üîç Anomalie'},
                {cmd: 'predykcja', label: 'ü§ñ AI'}
            ],
            'internet': [
                {cmd: 'pogoda', label: 'üå§Ô∏è Pogoda'},
                {cmd: 'bitcoin', label: '‚Çø Crypto'},
                {cmd: 'rss', label: 'üì∞ News'},
                {cmd: 'integracje', label: 'üîå Status'}
            ],
            'system': [
                {cmd: 'pomoc', label: '‚ùì Pomoc'},
                {cmd: 'status', label: 'üìä Status'},
                {cmd: 'login', label: 'üîê Login'},
                {cmd: 'start', label: 'üè† Home'}
            ]
        };
        
        function updateQuickActions(appType) {
            const grid = document.getElementById('quick-actions-grid');
            if (!grid) return;
            
            // First use static actions
            const actions = APP_QUICK_ACTIONS[appType] || APP_QUICK_ACTIONS['welcome'];
            grid.innerHTML = actions.map(a => 
                `<button class="quick-action-btn" onclick="sendCommand('${a.cmd}')">${a.label}</button>`
            ).join('');
            
            // Then try to load from Makefile API
            loadMakefileCommands(appType);
        }
        
        // ===== LOAD COMMANDS FROM MAKEFILE API =====
        async function loadMakefileCommands(appType) {
            // Map view type to app_id
            const appMap = {
                'welcome': null,
                'internet': 'weather',
                'documents': 'documents',
                'system': 'registry'
            };
            
            const appId = appMap[appType];
            if (!appId) return;
            
            try {
                const response = await fetch(`/api/apps/${appId}/makefiles/user`);
                if (!response.ok) return;
                
                const data = await response.json();
                const commands = data.commands || [];
                
                if (commands.length > 0) {
                    const grid = document.getElementById('quick-actions-grid');
                    if (!grid) return;
                    
                    // Show first 4 commands from Makefile
                    const makeActions = commands.slice(0, 4).map(c => ({
                        cmd: c.description || c.target,
                        label: c.target
                    }));
                    
                    grid.innerHTML = makeActions.map(a => 
                        `<button class="quick-action-btn" onclick="executeViaText2Makefile('${a.cmd}', '${appId}')">${a.label}</button>`
                    ).join('');
                }
            } catch(e) {
                console.log('Makefile API not available:', e);
            }
        }
        
        // ===== EXECUTE VIA TEXT2MAKEFILE =====
        async function executeViaText2Makefile(text, appId) {
            addChatMessage(text, 'user');
            
            try {
                const response = await fetch('/api/command/execute', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({text, app_id: appId, role: 'user'})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Show output
                    let output = data.output;
                    if (typeof output === 'object') {
                        output = JSON.stringify(output, null, 2);
                    }
                    addChatMessage(`‚úÖ ${output}`, 'assistant');
                } else if (data.conversion) {
                    // Show conversion result
                    addChatMessage(`üîÑ ${data.conversion.command}`, 'assistant');
                } else {
                    addChatMessage(`‚ùå ${data.error || 'Nieznany b≈ÇƒÖd'}`, 'assistant');
                }
            } catch(e) {
                addChatMessage(`‚ùå B≈ÇƒÖd: ${e.message}`, 'assistant');
            }
        }
        
        // ===== LANGUAGE STATE =====
        // currentLanguage already declared in LANGUAGE MANAGEMENT section
        let translations = {};
        
        // ===== CONFIG MODAL =====
        async function showConfig() {
            const modal = document.getElementById('config-modal');
            const body = document.getElementById('config-modal-body');
            
            body.innerHTML = '<p>≈Åadowanie...</p>';
            modal.classList.add('active');
            
            try {
                const [llmRes, langRes, currLangRes] = await Promise.all([
                    fetch('/api/llm/providers'),
                    fetch('/api/languages'),
                    fetch('/api/language')
                ]);
                
                const llmData = await llmRes.json();
                const langData = await langRes.json();
                const currLang = await currLangRes.json();
                
                currentLanguage = currLang.language;
                
                let html = `
                    <div class="config-item">
                        <label>üåê Jƒôzyk / Language</label>
                        <select id="language-select" onchange="changeLanguage()">
                            ${langData.languages.map(l => 
                                `<option value="${l.code}" ${l.code === currentLanguage ? 'selected' : ''}>${l.native_name} (${l.name})</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="config-item">
                        <label>ü§ñ LLM Provider</label>
                        <select id="llm-provider" onchange="changeLLM()">
                            ${llmData.providers.map(p => 
                                `<option value="${p.id}" ${p.is_active ? 'selected' : ''}>${p.name}</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="config-item">
                        <label>üîä TTS</label>
                        <select id="tts-setting" onchange="toggleTTSSetting()">
                            <option value="on" ${ttsEnabled ? 'selected' : ''}>‚úÖ ${translate('enabled', 'W≈ÇƒÖczony')}</option>
                            <option value="off" ${!ttsEnabled ? 'selected' : ''}>‚ùå ${translate('disabled', 'Wy≈ÇƒÖczony')}</option>
                        </select>
                    </div>
                    <div class="config-item">
                        <label>üé§ STT</label>
                        <select id="stt-setting" onchange="toggleSTTSetting()">
                            <option value="on">‚úÖ ${translate('enabled', 'W≈ÇƒÖczony')}</option>
                            <option value="off">‚ùå ${translate('disabled', 'Wy≈ÇƒÖczony')}</option>
                        </select>
                    </div>
                    <div class="config-item">
                        <label>üé® ${translate('theme', 'Motyw')}</label>
                        <select id="theme-select" disabled>
                            <option selected>üåô Dark</option>
                        </select>
                    </div>
                    <hr style="border-color: var(--border); margin: 12px 0;">
                    <div class="config-item">
                        <label>üì¶ ${translate('generate_app', 'Generuj App')}</label>
                        <button onclick="showAppGenerator()" style="padding: 6px 12px; background: var(--primary); border: none; border-radius: 4px; color: white; cursor: pointer;">
                            üè≠ Generator
                        </button>
                    </div>
                `;
                body.innerHTML = html;
            } catch(e) {
                body.innerHTML = '<p style="color: var(--danger);">B≈ÇƒÖd ≈Çadowania konfiguracji</p>';
            }
        }
        
        function translate(key, fallback) {
            return translations[key] || fallback;
        }
        
        async function changeLanguage() {
            const lang = document.getElementById('language-select').value;
            try {
                await fetch('/api/language', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({language: lang, session_id: clientId})
                });
                
                // Update translations
                const transRes = await fetch(`/api/translations?session_id=${clientId}`);
                const transData = await transRes.json();
                translations = transData.translations;
                currentLanguage = lang;
                
                // Update STT language
                if (recognition) {
                    const sttConfig = await (await fetch(`/api/stt/config?session_id=${clientId}`)).json();
                    recognition.lang = sttConfig.language;
                }
                
                addChatMessage(`üåê ${translate('language_changed', 'Jƒôzyk zmieniony')}: ${lang.toUpperCase()}`, 'assistant');
            } catch(e) {
                addChatMessage('‚ùå B≈ÇƒÖd zmiany jƒôzyka', 'assistant');
            }
        }
        
        async function changeLLM() {
            const provider = document.getElementById('llm-provider').value;
            try {
                await fetch('/api/llm/active', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({provider})
                });
                addChatMessage(`‚úÖ LLM: ${provider}`, 'assistant');
            } catch(e) {
                addChatMessage('‚ùå B≈ÇƒÖd zmiany LLM', 'assistant');
            }
        }
        
        function toggleTTSSetting() {
            ttsEnabled = document.getElementById('tts-setting').value === 'on';
            document.getElementById('tts-btn').classList.toggle('active', ttsEnabled);
        }
        
        function toggleSTTSetting() {
            const enabled = document.getElementById('stt-setting').value === 'on';
            if (!enabled && isListening) {
                recognition?.stop();
            }
        }
        
        // ===== APP GENERATOR MODAL =====
        async function showAppGenerator() {
            closeModal('config-modal');
            
            const modal = document.getElementById('services-modal');
            const body = document.getElementById('services-modal-body');
            document.querySelector('#services-modal h3').textContent = 'üè≠ App Generator';
            
            body.innerHTML = '<p>≈Åadowanie...</p>';
            modal.classList.add('active');
            
            try {
                const regRes = await fetch('/api/generator/registries');
                const regData = await regRes.json();
                
                body.innerHTML = `
                    <h4 style="margin-bottom: 10px;">üì¶ Z pakietu (npm/pypi/docker)</h4>
                    <div class="config-item">
                        <label>Rejestr</label>
                        <select id="gen-registry">
                            ${regData.registries.map(r => 
                                `<option value="${r.id}">${r.name}</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="config-item">
                        <label>Pakiet</label>
                        <input type="text" id="gen-package" placeholder="np. express, flask, nginx" style="flex:1">
                    </div>
                    <button onclick="generateFromPackage()" style="width:100%; padding:10px; background:var(--primary); border:none; border-radius:6px; color:white; cursor:pointer; margin-bottom:15px;">
                        üöÄ Generuj z pakietu
                    </button>
                    
                    <h4 style="margin-bottom: 10px;">üîå Z API Docs URL</h4>
                    <div class="config-item">
                        <label>URL</label>
                        <input type="text" id="gen-api-url" placeholder="https://api.example.com/docs" style="flex:1">
                    </div>
                    <button onclick="generateFromApiDocs()" style="width:100%; padding:10px; background:var(--success); border:none; border-radius:6px; color:white; cursor:pointer;">
                        üîå Generuj z API
                    </button>
                `;
            } catch(e) {
                body.innerHTML = '<p style="color: var(--danger);">B≈ÇƒÖd ≈Çadowania</p>';
            }
        }
        
        async function generateFromPackage() {
            const registry = document.getElementById('gen-registry').value;
            const pkg = document.getElementById('gen-package').value;
            
            if (!pkg) {
                alert('Podaj nazwƒô pakietu');
                return;
            }
            
            addChatMessage(`üè≠ Generujƒô app z ${registry}/${pkg}...`, 'assistant');
            closeModal('services-modal');
            
            try {
                const res = await fetch('/api/generator/from-package', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({registry, package: pkg})
                });
                const data = await res.json();
                
                if (data.success) {
                    addChatMessage(`‚úÖ App wygenerowana: ${data.app_id}`, 'assistant');
                } else {
                    addChatMessage(`‚ùå B≈ÇƒÖd: ${data.error}`, 'assistant');
                }
            } catch(e) {
                addChatMessage(`‚ùå B≈ÇƒÖd: ${e.message}`, 'assistant');
            }
        }
        
        async function generateFromApiDocs() {
            const url = document.getElementById('gen-api-url').value;
            
            if (!url) {
                alert('Podaj URL do API docs');
                return;
            }
            
            addChatMessage(`üîå Generujƒô app z API: ${url}...`, 'assistant');
            closeModal('services-modal');
            
            try {
                const res = await fetch('/api/generator/from-api-docs', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({url})
                });
                const data = await res.json();
                
                if (data.success) {
                    addChatMessage(`‚úÖ API App wygenerowana: ${data.app_id} (${data.commands} komend)`, 'assistant');
                } else {
                    addChatMessage(`‚ùå B≈ÇƒÖd: ${data.error}`, 'assistant');
                }
            } catch(e) {
                addChatMessage(`‚ùå B≈ÇƒÖd: ${e.message}`, 'assistant');
            }
        }
        
        // ===== SERVICES MODAL =====
        async function showServices() {
            const modal = document.getElementById('services-modal');
            const body = document.getElementById('services-modal-body');
            
            body.innerHTML = '<p>≈Åadowanie...</p>';
            modal.classList.add('active');
            
            try {
                const [servicesRes, llmRes] = await Promise.all([
                    fetch('/api/db/services'),
                    fetch('/api/llm/health')
                ]);
                
                const services = await servicesRes.json();
                const llmHealth = await llmRes.json();
                
                let html = '<h4 style="margin-bottom: 10px;">LLM Providers</h4>';
                
                for (const [id, status] of Object.entries(llmHealth)) {
                    const statusClass = status.status === 'healthy' ? 'healthy' : 
                                       status.status === 'offline' ? 'offline' : 'unknown';
                    html += `
                        <div class="service-item">
                            <div class="service-status ${statusClass}"></div>
                            <span class="service-name">${id}</span>
                            <span style="font-size: 0.7rem; color: var(--text-secondary);">${status.status}</span>
                            <button class="service-action" onclick="testService('${id}')">Test</button>
                        </div>
                    `;
                }
                
                html += '<h4 style="margin: 15px 0 10px;">Integracje</h4>';
                
                for (const s of services.services || []) {
                    const statusClass = s.status === 'healthy' ? 'healthy' : 
                                       s.status === 'offline' ? 'offline' : 'unknown';
                    html += `
                        <div class="service-item">
                            <div class="service-status ${statusClass}"></div>
                            <span class="service-name">${s.name}</span>
                            <span style="font-size: 0.7rem; color: var(--text-secondary);">${s.status}</span>
                            <button class="service-action" onclick="checkService('${s.id}')">Check</button>
                        </div>
                    `;
                }
                
                body.innerHTML = html;
            } catch(e) {
                body.innerHTML = '<p style="color: var(--danger);">B≈ÇƒÖd ≈Çadowania us≈Çug</p>';
            }
        }
        
        async function testService(serviceId) {
            addChatMessage(`üîç Testujƒô us≈Çugƒô: ${serviceId}...`, 'assistant');
            try {
                const response = await fetch(`/api/llm/health`);
                const data = await response.json();
                const status = data[serviceId]?.status || 'unknown';
                addChatMessage(`${status === 'healthy' ? '‚úÖ' : '‚ùå'} ${serviceId}: ${status}`, 'assistant');
            } catch(e) {
                addChatMessage(`‚ùå B≈ÇƒÖd testu: ${serviceId}`, 'assistant');
            }
        }
        
        async function checkService(serviceId) {
            addChatMessage(`üîç Sprawdzam us≈Çugƒô: ${serviceId}...`, 'assistant');
            try {
                const response = await fetch(`/api/db/services/${serviceId}/check`, {method: 'POST'});
                const data = await response.json();
                addChatMessage(`${data.status === 'healthy' ? '‚úÖ' : '‚ùå'} ${serviceId}: ${data.status}`, 'assistant');
            } catch(e) {
                addChatMessage(`‚ùå B≈ÇƒÖd sprawdzenia: ${serviceId}`, 'assistant');
            }
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // Close modal on overlay click
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.classList.remove('active');
            });
        });
        
        // ===== INIT =====
        document.addEventListener('DOMContentLoaded', () => {
            // Load saved history
            loadHistory();
            
            // Connect WebSocket
            connectWebSocket();
            initSpeechRecognition();
            
            // Initialize quick actions
            updateQuickActions('welcome');
            
            // Check URL for command on load
            const urlCmd = getURLCommand();
            if (urlCmd) {
                setTimeout(() => sendCommand(urlCmd), 500);
            }
        });
        
        // Update location bar when view changes
        const originalRenderView = renderView;
        renderView = function(view) {
            originalRenderView(view);
            updateLocationBar(view);
        };
    </script>
</body>
</html>
